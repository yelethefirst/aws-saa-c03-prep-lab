#!/usr/bin/env bash

# Exit immediately if a command exits with a non-zero status.
set -e

if [ -z "$1" ]; then
    echo "Usage: $0 <bucket-name>"
    exit 1
fi

bucket_name="$1"

# where we'll store the local files
local_dir="/tmp/s3-sync-demo"

# clean up previous run
rm -rf "$local_dir"

# create the directory
mkdir -p "$local_dir"

# create some dummy files to sync
echo "Generating local files in $local_dir..."
for i in {1..3}; do
    filename="sync-file-$i.txt"
    openssl rand -base64 32 > "$local_dir/$filename"
done

echo "Local files created:"
ls -l "$local_dir"

echo "Syncing $local_dir to s3://$bucket_name..."
aws s3 sync "$local_dir" "s3://$bucket_name"

echo "Sync complete."
